# âœ¨ Claude API Integration - Setup Guide

## Quick Start

Your game now supports **dynamic AI-generated merchants** powered by Claude API!

### 1. Get a Claude API Key

1. Visit [console.anthropic.com](https://console.anthropic.com/)
2. Sign up or log in
3. Navigate to API Keys
4. Create a new API key (starts with `sk-ant-`)

### 2. Configure in Game

1. Open `index.html` in your browser
2. Click **"âš™ï¸ Claude API Settings"**
3. Paste your API key
4. Click **"ðŸ’¾ Save API Key"**
5. Enable **"âœ¨ Dynamic AI (Claude)"** toggle

### 3. Play!

- Click **"ðŸ”„ Reset Game"** to generate a new Claude-powered merchant
- Each merchant will have:
  - Unique name & backstory
  - Personalized speaking style
  - Custom quirks & catchphrases
  - Dynamic dialogue in negotiations

---

## What's Different with Claude?

### Static Merchants (Default)
- 3 preset personalities: Greedy, Honest, Impulsive
- Pre-written response templates (~40 variations)
- Instant responses
- No API costs

### Claude-Powered Merchants
- **Infinite unique personalities** generated on demand
- Each has backstory, quirks, likes, dislikes
- **Real-time dialogue generation** based on:
  - Current mood & trust
  - Negotiation context
  - Speaking style
  - Bluff detection
- 2-3 second generation time
- Small API cost per merchant (~$0.01-0.02)

---

## Example Claude Merchants

**"Krix'tal" - Former Smuggler**
- Speaking Style: Casual, street-smart
- Quirks: Taps fingers when thinking, always checks exits
- Catchphrases: "Credits talk, friend", "I've seen worse deals"
- Negotiation: Direct, respects bold offers

**"Zephyx" - Psionic Scholar**
- Speaking Style: Formal, philosophical
- Quirks: Pauses before speaking, references ancient texts
- Catchphrases: "The universe balances all", "Wisdom has its price"
- Negotiation: Methodical, values patience

---

## Technical Details

### Files Added
- `claude-addon.js` - Integration layer (included in index.html)
- `CLAUDE-SETUP.md` - This file

### Files Modified
- `index.html` - Added Claude settings panel & UI toggle
- `game.ts` - Added async merchant generation & message hooks
- `game.js` - Recompiled with ES2017 (async/await support)

### API Usage
- **Personality Generation**: ~800-1000 tokens (~$0.012)
- **Message Generation**: ~100-150 tokens (~$0.002)
- **Model Used**: Claude 3.5 Sonnet (fast, high quality)

### Storage
- API key stored in browser `localStorage`
- Never sent anywhere except Anthropic API
- Clear browser data to remove

---

## Troubleshooting

**"Dynamic AI" toggle is disabled**
- Ensure you saved a valid API key (starts with `sk-ant-`)
- Check browser console for errors

**Merchant generation takes too long**
- First generation: 2-3 seconds (normal)
- If > 10 seconds: Check internet connection
- API may be rate-limited (wait 1 minute)

**Dialogue is generic/repetitive**
- Claude fallback to static templates if API fails
- Check API key is valid
- Verify API credits in Anthropic console

**"API error: 401"**
- Invalid API key
- Re-enter key in settings

**"API error: 429"**
- Rate limit exceeded
- Wait 60 seconds and try again

---

## Cost Estimation

Based on typical gameplay:

- **1 merchant**: ~$0.012 (personality generation)
- **10 messages**: ~$0.02 (dialogue during negotiation)
- **Average game session**: ~$0.03-0.05

**Optimization Tips:**
- Reuse same merchant across multiple deals
- Disable dynamic mode for casual play
- Enable only for special sessions

---

## Fallback Behavior

The game **always works** even if Claude fails:

1. **API key missing**: Uses static merchants
2. **API call fails**: Uses static merchants
3. **Message generation fails**: Uses template responses
4. **Network error**: Graceful fallback

No API key? Game works perfectly with 3 preset personalities!

---

## Privacy & Security

- **API key** stored locally in browser only
- **No data collection** - all processing via Anthropic API
- **No user data** sent to Claude (only game context)
- **Conversation** not retained by API (per Anthropic policy)

---

## Future Enhancements

Possible additions:
- Merchant memory across sessions
- Reputation system (merchant remembers you)
- Special events/quests generated by Claude
- Multiplayer with Claude-mediated negotiations

---

## Support

Questions? Check:
- [Anthropic API Docs](https://docs.anthropic.com/)
- [Claude API Pricing](https://www.anthropic.com/pricing)
- Game console logs (F12 in browser)

Enjoy your dynamic AI merchants! ðŸ¤–âœ¨
