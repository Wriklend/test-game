<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Bargains - AI Merchant Negotiation</title>
    <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="game-header">
            <h1>â­ Stellar Bargains</h1>
            <div class="player-stats">
                <span class="balance">ğŸ’° <strong id="balance">1000</strong> coins</span>
                <span class="profit">ğŸ“ˆ Profit: <strong id="profit">0</strong></span>
            </div>
        </header>

        <!-- Player Panel -->
        <section class="player-panel">
            <div class="player-avatar" id="player-avatar">ğŸ‘¤</div>
            <div class="player-details">
                <h2 id="player-name">Generating...</h2>
                <p id="player-info">Species: Loading... | Profession: Loading...</p>
                <p id="player-backstory" class="backstory">Loading backstory...</p>
            </div>
            <div class="player-traits">
                <span class="trait" id="player-ability" title="Special Ability">âš¡ Loading...</span>
                <span class="trait weakness" id="player-weakness" title="Weakness">âš ï¸ Loading...</span>
            </div>
        </section>

        <!-- Inventory Panel -->
        <section class="inventory-panel" id="inventory-panel">
            <h3>ğŸ“¦ Your Inventory <span id="inventory-count">(0 items)</span></h3>
            <div class="inventory-grid" id="inventory-grid">
                <p class="inventory-empty" id="inventory-empty">No items yet. Buy something first!</p>
            </div>
        </section>

        <!-- Merchant Panel -->
        <section class="merchant-panel">
            <div class="merchant-avatar">ğŸ¤–</div>
            <div class="merchant-details">
                <h2 id="merchant-name">Merchant Zyx</h2>
                <p id="merchant-personality">Type: Loading...</p>
            </div>
            <div class="merchant-stats">
                <div class="mood-indicator">
                    <label>Mood:</label>
                    <div class="meter">
                        <div id="mood-fill" class="fill" style="width: 50%"></div>
                    </div>
                    <span id="mood-emoji" class="mood-emoji">ğŸ˜</span>
                </div>
                <div class="trust-indicator">
                    <label>Trust:</label>
                    <div class="meter">
                        <div id="trust-fill" class="fill" style="width: 50%"></div>
                    </div>
                    <span id="trust-value">50</span>
                </div>
            </div>
        </section>

        <!-- Game Controls -->
        <section class="game-controls">
            <button id="btn-buy" class="mode-btn">ğŸ›’ BUY from Merchant</button>
            <button id="btn-sell" class="mode-btn">ğŸ’µ SELL to Merchant</button>
            <button id="btn-reset" class="action-btn">ğŸ”„ Reset Game</button>
            <label class="toggle">
                <input type="checkbox" id="hard-mode">
                <span>âš¡ Hard Mode (4 rounds instead of 6)</span>
            </label>
        </section>

        <!-- Claude Settings Panel -->
        <section class="tutorial-panel" id="claude-settings">
            <button class="toggle-tutorial" id="toggle-claude-btn">âš™ï¸ About This Game</button>
            <div class="tutorial-content hidden" id="claude-content">
                <h3>ğŸ¤– AI-Powered Game</h3>
                <p><strong>This game is powered by Claude AI.</strong> All merchant personalities, negotiation decisions, and dialogue are generated by Claude in real-time.</p>

                <div id="api-status" style="padding: 10px; border-radius: 6px; background: rgba(0,0,0,0.3); font-size: 0.9rem; margin: 15px 0;">
                    Status: <span id="api-status-text" style="color: var(--warning);">Checking...</span>
                </div>

                <h3>Setup (Dev Mode)</h3>
                <ol style="line-height: 1.8;">
                    <li>Get your API key from <a href="https://console.anthropic.com/" target="_blank" style="color: var(--accent-cyan);">console.anthropic.com</a></li>
                    <li>Add it to <code>.env</code> file: <code>CLAUDE_API_KEY=your-key-here</code></li>
                    <li>Restart the dev server: <code>npm run dev</code></li>
                </ol>

                <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 10px;">
                    Note: The API key is stored server-side in <code>.env</code> file (never exposed to browser).
                </p>

                <h3 style="margin-top: 20px;">How It Works</h3>
                <ul>
                    <li><strong>Unique Merchants:</strong> Each merchant is uniquely generated with backstory, quirks, and personality</li>
                    <li><strong>Real AI Decisions:</strong> Claude AI decides whether to accept, counter, or reject your offers</li>
                    <li><strong>Dynamic Dialogue:</strong> All merchant responses are generated in real-time based on context</li>
                    <li><strong>Adaptive Behavior:</strong> The AI tracks mood, trust, and offer history to make realistic decisions</li>
                    <li><strong>Infinite Variety:</strong> Every merchant and negotiation is unique</li>
                </ul>

                <p style="margin-top: 15px; font-size: 0.85rem; color: var(--text-muted);">
                    Note: API calls cost a small amount per request (~$0.01-0.02 per negotiation). Your API key is stored locally in your browser.
                </p>
            </div>
        </section>

        <!-- Tutorial Panel -->
        <section class="tutorial-panel" id="tutorial">
            <button class="toggle-tutorial" id="toggle-tutorial-btn">â“ How to Play</button>
            <div class="tutorial-content hidden" id="tutorial-content">
                <h3>ğŸ¯ Objective</h3>
                <p>Every item has a hidden <strong>fair value</strong>. Your goal: <strong>BUY below fair value</strong> or <strong>SELL above fair value</strong> to profit!</p>

                <h3>ğŸ’° Understanding Prices</h3>
                <ul>
                    <li><strong>Fair Value:</strong> The true market price (hidden from you until deal closes)</li>
                    <li><strong>Market Estimate:</strong> A rough hint (Â±15-30% off) - use it as a starting point, not gospel</li>
                    <li><strong>Your Goal:</strong> Negotiate toward the fair value while getting a better deal than the merchant</li>
                </ul>

                <h3>ğŸ® How Negotiation Works</h3>
                <ul>
                    <li><strong>BUY mode:</strong> You want to pay LESS than fair value. Start low, meet in the middle.</li>
                    <li><strong>SELL mode:</strong> You want to receive MORE than fair value. Start high, meet in the middle.</li>
                    <li>The merchant will COUNTER with prices that converge toward fair value</li>
                    <li>Each round, offers should get closer together until you reach a deal</li>
                    <li>You have 6 rounds (4 in Hard Mode) to close the deal</li>
                </ul>

                <h3>ğŸ¤– Merchant Behavior</h3>
                <ul>
                    <li><strong>Mood (-100 to +100):</strong> Happy merchants make more concessions. Angry merchants may reject deals.</li>
                    <li><strong>Trust (0-100):</strong> Low trust = stricter on prices. Build trust with fair offers.</li>
                    <li>Extreme offers (too low/high) hurt mood and trust</li>
                    <li>Each merchant has a unique AI-generated personality</li>
                </ul>

                <h3>ğŸ’¡ Strategy Tips</h3>
                <ul>
                    <li>Start reasonable - offers within 50-150% of market estimate</li>
                    <li>Move toward the middle each round - don't jump around</li>
                    <li>Watch the merchant's counters - they hint at fair value</li>
                    <li>Late rounds = more flexibility - push harder if needed</li>
                </ul>
            </div>
        </section>

        <!-- Item Display -->
        <section class="item-panel hidden" id="item-panel">
            <div class="item-card">
                <div class="item-header">
                    <h2 id="item-name">Item Name</h2>
                    <span id="item-rarity" class="badge">RARITY</span>
                    <span id="item-condition" class="badge">CONDITION</span>
                </div>
                <p id="item-description" class="item-description">Item description</p>
                <div class="item-price">
                    <span class="label">ğŸ’« Market Estimate:</span>
                    <span id="item-hint" class="price">~000 coins</span>
                </div>
            </div>
        </section>

        <!-- Negotiation Interface -->
        <section class="negotiation-panel hidden" id="negotiation-panel">
            <div class="negotiation-header">
                <span id="mode-indicator">MODE: BUYING</span>
                <span id="round-indicator">Round: <span id="current-round">1</span> / <span id="max-rounds">6</span></span>
            </div>

            <div class="offer-input">
                <label for="player-offer">Your Offer:</label>
                <input type="number" id="player-offer" placeholder="Enter amount in coins" min="1">
                <button id="btn-submit-offer" class="submit-btn">Submit Offer</button>
            </div>

            <div class="negotiation-log" id="negotiation-log">
                <!-- Dynamic log entries will appear here -->
            </div>
        </section>

        <!-- Deal Summary Modal -->
        <div class="modal hidden" id="deal-modal">
            <div class="modal-content deal-summary">
                <div class="deal-icon" id="deal-icon">âœ…</div>
                <h2 id="deal-result">Deal Result</h2>
                <p class="deal-mode" id="deal-mode">You bought an item</p>

                <div class="deal-item-info">
                    <span class="deal-item-name" id="deal-item-name">Item Name</span>
                </div>

                <div class="deal-breakdown">
                    <div class="deal-row">
                        <span class="deal-label">Your Price</span>
                        <span class="deal-value" id="final-price">0</span>
                    </div>
                    <div class="deal-row">
                        <span class="deal-label">Market Value</span>
                        <span class="deal-value muted" id="fair-value">0</span>
                    </div>
                    <div class="deal-divider"></div>
                    <div class="deal-row profit-row">
                        <span class="deal-label" id="profit-label">You Saved</span>
                        <span class="deal-value" id="deal-profit">0</span>
                    </div>
                </div>

                <div class="deal-verdict" id="deal-verdict">
                    <span class="verdict-emoji">ğŸ‰</span>
                    <span class="verdict-text">Great deal!</span>
                </div>

                <button id="btn-close-modal" class="action-btn" style="width: 100%;">Next Merchant</button>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h2 id="loading-title">Initializing Game</h2>
                <p id="loading-message">Generating your character...</p>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
</body>
</html>
